
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Building a Sequencer Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
  
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="06_the_mixing_stage.html" />
    
    
    <link rel="prev" href="04_drums.html" />
    

  <script src="js/player.js" type="text/javascript"></script>
  <script type="text/javascript">
    window.addEventListener('DOMContentLoaded', (event) => {
      initPlayer()
    });
  </script>
  <style type="text/css">
    canvas.scope {
      background: #000;
    }
    .player {
      width: 200px;
      display: inline-block;
    }
    .player-fft {
      width: 600px;
      display: inline-block;
    }
    .player button {
      display: block;
      width: 100%;
      background: green;
      border: 1px solid black;
      box-shadow: 2px 2px 3px rgba(0,0,0,0.2);
      border-radius: 5px;
      padding: 5px;
      color: #fff;
    }
  </style>

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="02_what_is_sound.html">
            
                <a href="02_what_is_sound.html">
            
                    
                    What is Sound
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="03_shaping_sound.html">
            
                <a href="03_shaping_sound.html">
            
                    
                    Shaping Sound
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="04_drums.html">
            
                <a href="04_drums.html">
            
                    
                    Making Drums
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5" data-path="05_sequencer.html">
            
                <a href="05_sequencer.html">
            
                    
                    Building a Sequencer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="06_the_mixing_stage.html">
            
                <a href="06_the_mixing_stage.html">
            
                    
                    The Mixing stage
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Building a Sequencer</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="sequencing-basics">Sequencing basics</h1>
<p>Now that we have our sound repertoire, we can start to think about how to turn these single sounds into actual music.</p>
<p>For that, we need to learn a little about sequencing and rhythm.</p>
<h2 id="a-bar-and-a-beat">A bar and a beat</h2>
<p>Most modern dance music (as is most music you would hear on the radio) is writting in a straight 4/4 metric. But what does that mean?</p>
<p>It means that a measure (or bar) of our music is comprised of four quarter notes. A quarter note in in this measure represents a beat.</p>
<p>I&apos;m not going to go into more detail about rhythm, because the 4/4 is so easy to work with and this can get complicated very quickly - just one quick example of a different beat, here&apos;s a 6/8 walz.</p>
<p>Tempo in music is often measured in beats per minute or short BPM. For 4/4, this very conveniently means that we can simply count the quarter notes. To make things even more simpler, we can stick to a very typical (for, say, slow house music) 120 BPM and thus we can determine that we&apos;ll need 2 beats per second, meaning that each beat is half a second long.</p>
<p>Each 16th note will thus be 1/8 of a second long. This is relevant because a 16th note is a very common unit used in so calles step sequencers, made popular by drum machines like the legendary Roland 808, pictured below, which used 16 buttons to make it easy to program these 16 steps in a bar in a very convenient manner.</p>
<p><img src="images/roland_808.jpg" alt="The Roland 808"></p>
<p>Here&apos;s how you would do the math in code:</p>
<pre><code class="lang-ruby">BPM = <span class="hljs-number">120</span>
beat_length_in_seconds = <span class="hljs-number">60</span> / BPM <span class="hljs-comment"># = 0.5s</span>
bar_length = beat_length_in_seconds * <span class="hljs-number">4</span> <span class="hljs-comment"># = 2s</span>
sixteenth_note_length = beat_length_in_seconds / <span class="hljs-number">4</span> <span class="hljs-comment"># = 0.125s</span>
</code></pre>
<h2 id="patterns">Patterns</h2>
<p>Most modern dance music is developed on a basis of so called patterns. patterns, in this case mean small chunks of music, often a bar for example or multiples thereof, that can then be assembled into full songs. A pattern could be a drum pattern for example.</p>
<p>Here&apos;s a screenshot of how that looks in a modern music production software, in this case Ableton Live, which I also use to produce music if I&apos;m not programming it in Ruby:</p>
<p><img src="../presentation/images/notes_patterns_songs.png" alt="Screenshot of the arrange view of Ableton Live"></p>
<p>In a way, you can think of patterns as abstractions that can be reused. Which brings us back to the question of how we could best represent this in code.</p>
<h2 id="lets-make-a-dsl-for-that">Let&apos;s make a DSL for that.</h2>
<p>Here&apos;s some &quot;dream code&quot; to define a drum pattern:</p>
<pre><code class="lang-ruby">def_pattern(<span class="hljs-symbol">:drums_full</span>, <span class="hljs-number">16</span>) <span class="hljs-keyword">do</span>
  drum_pattern kick_drum,   <span class="hljs-string">&apos;*---*---*---*---&apos;</span>
  drum_pattern snare_drum,  <span class="hljs-string">&apos;----*-------*---&apos;</span>
  drum_pattern hihat,       <span class="hljs-string">&apos;--*---*---*---*-&apos;</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>The following example is a first crude idea on how melody pattern definitions could look like:</p>
<pre><code class="lang-ruby">def_pattern(<span class="hljs-symbol">:bassline</span>, <span class="hljs-number">16</span>) <span class="hljs-keyword">do</span>
  note_pattern monosynth, [
    [<span class="hljs-string">&apos;C1&apos;</span>, <span class="hljs-number">4</span>], P, P, P,
    P, P, P, P,
    [<span class="hljs-string">&apos;C#1&apos;</span>, <span class="hljs-number">6</span>], P, P, P,
    P, P, P, P
  ]
<span class="hljs-keyword">end</span>
</code></pre>
<p>The P in there is just a constant set to nil, and stands for &quot;Pause&quot;. The array contains a note (note and octave) and a length in steps (or 1/16 notes).</p>
<p>Now, let&apos;s take these pattern definitions and then turn them into a song:</p>
<pre><code class="lang-ruby">length = song(<span class="hljs-symbol">bpm:</span> <span class="hljs-number">115</span>) <span class="hljs-keyword">do</span>
  pattern(<span class="hljs-symbol">:drums_full</span>, <span class="hljs-symbol">at:</span> <span class="hljs-number">0</span>, <span class="hljs-symbol">repeat:</span> <span class="hljs-number">1</span>)
  pattern(<span class="hljs-symbol">:drums_full</span>, <span class="hljs-symbol">at:</span> <span class="hljs-number">2</span>, <span class="hljs-symbol">repeat:</span> <span class="hljs-number">2</span>)
  pattern(<span class="hljs-symbol">:bassline</span>, <span class="hljs-symbol">at:</span> <span class="hljs-number">0</span>, <span class="hljs-symbol">repeat:</span> <span class="hljs-number">4</span>)
  pattern(<span class="hljs-symbol">:chord</span>, <span class="hljs-symbol">at:</span> <span class="hljs-number">0</span>, <span class="hljs-symbol">repeat:</span> <span class="hljs-number">4</span>)
<span class="hljs-keyword">end</span>
</code></pre>
<p>So, you can start a pattern at a certain position (specified in bars this time) and you can repeat them as many times as you want. Together with setting the tempo, this code can now schdule all notes to all the instruments.</p>
<p>The code to make this all work is a bit too long to list it all here, so please, by all means take a look at lib/sequencer_dsl.rb.</p>
<p>Additonally, take a look at lib/sound.rb which is the base class for every sound generator and among other things completely handles interpreting the scheduled events into a coherent view usable by the generator to use during rendering.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="04_drums.html" class="navigation navigation-prev " aria-label="Previous page: Making Drums">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="06_the_mixing_stage.html" class="navigation navigation-next " aria-label="Next page: The Mixing stage">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Building a Sequencer","level":"1.5","depth":1,"next":{"title":"The Mixing stage","level":"1.6","depth":1,"path":"06_the_mixing_stage.md","ref":"06_the_mixing_stage.md","articles":[]},"previous":{"title":"Making Drums","level":"1.4","depth":1,"path":"04_drums.md","ref":"04_drums.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"05_sequencer.md","mtime":"2019-06-16T04:58:20.612Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-06-18T06:33:56.902Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

